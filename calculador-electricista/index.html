<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculador Electricista - Gecko Studio</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ö° Calculador Profesional para Electricistas</h1>
            <p>Presupuestos t√©cnicos con cumplimiento normativo REBT</p>
            <a href="../index.html" class="back-btn">‚Üê Volver al inicio</a>
        </header>

        <!-- Selector de modo -->
        <div id="mode-selector" class="mode-selector">
            <button type="button" class="mode-btn active" data-mode="manual" onclick="switchMode('manual')">
                üìù Formulario Manual
            </button>
            <button type="button" class="mode-btn" data-mode="ai" onclick="switchMode('ai')">
                ü§ñ Asistente IA
            </button>
            <button type="button" class="mode-btn" data-mode="plan" onclick="switchMode('plan')">
                üìê Analizar Plano
            </button>
        </div>

        <!-- Modo Asistente IA -->
        <section id="ai-mode" class="section" style="display: none;">
            <h2>ü§ñ Asistente IA para Electricistas</h2>
            <p class="subtitle">Describe tu instalaci√≥n y te ayudar√© a calcular el presupuesto</p>

            <div class="ai-chat-container">
                <div class="ai-messages" id="ai-messages">
                    <div class="ai-message bot">
                        <strong>Asistente:</strong> ¬°Hola! Soy tu asistente para calcular instalaciones el√©ctricas.
                        Describe el proyecto y te har√© preguntas para obtener todos los datos necesarios seg√∫n REBT.
                        <br><br>Por ejemplo: "Necesito una instalaci√≥n el√©ctrica para una vivienda nueva de 120m¬≤ con 3 habitaciones"
                    </div>
                </div>
                <div class="ai-input-container">
                    <textarea id="ai-input" placeholder="Describe tu proyecto el√©ctrico..." rows="3"></textarea>
                    <button onclick="sendAIMessage()" class="btn btn-primary">Enviar</button>
                </div>
            </div>
        </section>

        <!-- Modo An√°lisis de Plano -->
        <section id="plan-mode" class="section" style="display: none;">
            <h2>üìê An√°lisis de Plano con IA</h2>
            <p class="subtitle">Sube el plano de la instalaci√≥n y la IA extraer√° los datos autom√°ticamente</p>

            <div class="plan-upload-area">
                <div class="upload-zone" id="plan-upload-zone">
                    <div class="upload-icon">üì§</div>
                    <p>Arrastra el plano aqu√≠ o haz clic para seleccionar</p>
                    <p class="upload-hint">Formatos: PDF, JPG, PNG (m√°x. 10MB)</p>
                    <input type="file" id="plan-file" accept=".pdf,.jpg,.jpeg,.png" hidden>
                </div>
                <div id="plan-preview" style="display: none;">
                    <img id="plan-image" alt="Plano">
                    <button onclick="analyzePlan()" class="btn btn-primary">üîç Analizar con IA</button>
                </div>
            </div>
        </section>

        <!-- Formulario del proyecto -->
        <section id="form-section" class="section active">
            <h2>Datos del Proyecto El√©ctrico</h2>

            <form id="electrical-form">
                <!-- Datos b√°sicos -->
                <div class="form-section">
                    <h3>üìã Informaci√≥n General</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="project-type">
                                Tipo de instalaci√≥n:
                                <span class="tooltip-icon" data-tooltip="Determina los requisitos REBT aplicables. Vivienda nueva requiere todos los circuitos m√≠nimos (ITC-BT-25). Reforma puede aprovechar instalaci√≥n existente.">‚ÑπÔ∏è</span>
                            </label>
                            <select id="project-type" required>
                                <option value="">Selecciona tipo</option>
                                <option value="vivienda-nueva">Vivienda nueva</option>
                                <option value="reforma-integral">Reforma integral</option>
                                <option value="ampliacion">Ampliaci√≥n</option>
                                <option value="local-comercial">Local comercial</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="surface">
                                Superficie (m¬≤):
                                <span class="tooltip-icon" data-tooltip="La superficie determina la electrificaci√≥n m√≠nima requerida. Hasta 160m¬≤ = b√°sica (5.75kW), m√°s de 160m¬≤ = elevada (9.2kW o superior).">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="surface" min="30" max="500" required placeholder="150">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="power">
                                Potencia contratada deseada:
                                <span class="tooltip-icon" data-tooltip="Determina el ICP (Interruptor de Control de Potencia) y el cable de acometida. Mayor potencia permite m√°s aparatos simult√°neos pero incrementa coste de factura. M√≠nimo legal: 5.75kW (b√°sica), 9.2kW recomendado para viviendas >160m¬≤.">‚ÑπÔ∏è</span>
                            </label>
                            <select id="power" required>
                                <option value="">Selecciona potencia</option>
                                <option value="5.75">5,75 kW (B√°sica)</option>
                                <option value="9.2">9,2 kW (Est√°ndar)</option>
                                <option value="11.5">11,5 kW (Ampliada)</option>
                                <option value="15">15 kW (Premium)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="voltage">
                                Tensi√≥n de suministro:
                                <span class="tooltip-icon" data-tooltip="230V monof√°sica es est√°ndar para viviendas. 400V trif√°sica se usa en locales comerciales, viviendas con climatizaci√≥n potente o cargas superiores a 15kW. Afecta al c√°lculo de intensidades y protecciones.">‚ÑπÔ∏è</span>
                            </label>
                            <select id="voltage" required>
                                <option value="230">230V Monof√°sica</option>
                                <option value="400">400V Trif√°sica</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Circuitos y puntos -->
                <div class="form-section">
                    <h3>üîå Circuitos y Puntos de Uso</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="lighting-points">
                                Puntos de luz:
                                <span class="tooltip-icon" data-tooltip="Determina el n√∫mero de circuitos C1 (iluminaci√≥n) necesarios. REBT: m√≠nimo 1 circuito por cada 30 puntos de luz. Incluye focos, plafones, l√°mparas de techo y apliques. Afecta a la cantidad de cable 1.5mm¬≤ y magnetot√©rmicos 10A.">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="lighting-points" min="5" max="100" required placeholder="30">
                        </div>

                        <div class="form-group">
                            <label for="socket-points">
                                Tomas de corriente:
                                <span class="tooltip-icon" data-tooltip="N√∫mero de enchufes en toda la vivienda. REBT (ITC-BT-25): m√≠nimo 1 circuito C2 por cada 20 tomas. Incluye enchufes en salones, dormitorios, pasillos. Requiere cable 2.5mm¬≤ y magnetot√©rmicos 16A. No incluye tomas de ba√±o/cocina (circuito C5 separado).">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="socket-points" min="10" max="150" required placeholder="40">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="bathrooms">
                                Ba√±os:
                                <span class="tooltip-icon" data-tooltip="N√∫mero de cuartos de ba√±o completos. Cada ba√±o requiere circuito C5 independiente con tomas IP44 (protecci√≥n contra salpicaduras) seg√∫n ITC-BT-27. Determina n√∫mero de diferenciales 30mA tipo A y tomas con obturador infantil.">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="bathrooms" min="1" max="10" required placeholder="2">
                        </div>

                        <div class="form-group">
                            <label for="kitchen">
                                Cocina el√©ctrica:
                                <span class="tooltip-icon" data-tooltip="Tipo de placa de cocci√≥n. Determina circuito C3 (cocina/horno). Vitrocer√°mica: 6mm¬≤, 25A. Inducci√≥n: puede requerir 10mm¬≤, 32A si >7kW. Gas o sin cocina el√©ctrica seleccionar 'No'. Afecta significativamente a potencia total necesaria.">‚ÑπÔ∏è</span>
                            </label>
                            <select id="kitchen" required>
                                <option value="no">No</option>
                                <option value="vitro">Vitrocer√°mica</option>
                                <option value="induccion">Inducci√≥n</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Elementos especiales -->
                <div class="form-section">
                    <h3>‚≠ê Elementos Especiales</h3>

                    <div class="checkbox-grid">
                        <label>
                            <input type="checkbox" name="special" value="aire"> Aire acondicionado
                            <span class="tooltip-icon" data-tooltip="Circuito C11 dedicado. Requiere cable 6mm¬≤ o superior seg√∫n potencia, magnetot√©rmico 25A. Split >3kW necesita l√≠nea independiente desde cuadro. Incrementa potencia total +2-4kW.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="calefaccion"> Calefacci√≥n el√©ctrica
                            <span class="tooltip-icon" data-tooltip="Circuitos adicionales seg√∫n tipo (radiadores, suelo radiante). Requiere cable 4-6mm¬≤, 20-25A por circuito. Incrementa significativamente potencia necesaria (+5-10kW). Considerar trif√°sica si >10kW.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="horno"> Horno el√©ctrico
                            <span class="tooltip-icon" data-tooltip="Incluido en circuito C3 si se comparte con cocina, o circuito independiente si potencia >3kW. Cable 4-6mm¬≤, magnetot√©rmico 20-25A. Hornos empotrables suelen requerir toma espec√≠fica de 32A.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="lavadora"> Lavadora
                            <span class="tooltip-icon" data-tooltip="Circuito C4 o C5 seg√∫n ubicaci√≥n. Cable 2.5mm¬≤, magnetot√©rmico 16A. Si est√° en ba√±o requiere protecci√≥n IP44 y diferencial 30mA tipo A. REBT obliga a toma individual accesible.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="secadora"> Secadora
                            <span class="tooltip-icon" data-tooltip="Circuito C10 independiente. Cable 4mm¬≤, magnetot√©rmico 20A. Secadoras de condensaci√≥n/bomba de calor consumen 2-3kW. Requiere toma Schuko 16A accesible para mantenimiento.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="lavavajillas"> Lavavajillas
                            <span class="tooltip-icon" data-tooltip="Circuito C4 o C5 (cocina). Cable 2.5mm¬≤, magnetot√©rmico 16A. Consumo t√≠pico 2-2.5kW. Requiere toma accesible cerca del aparato con diferencial 30mA.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="termo"> Termo el√©ctrico
                            <span class="tooltip-icon" data-tooltip="Circuito independiente. Cable 2.5-4mm¬≤ seg√∫n potencia (50-80L: 2.5mm¬≤, >100L: 4mm¬≤). Magnetot√©rmico 16-20A. Requiere toma espec√≠fica con acceso para desconexi√≥n. Consumo 1.5-3kW.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="piscina"> Bomba piscina
                            <span class="tooltip-icon" data-tooltip="Circuito exterior con protecci√≥n IP65. Cable 2.5-4mm¬≤ seg√∫n distancia y potencia, magnetot√©rmico 16-20A. Diferencial 30mA obligatorio. Si iluminaci√≥n piscina: diferencial espec√≠fico 10mA (ITC-BT-31).">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="ve"> Cargador veh√≠culo el√©ctrico
                            <span class="tooltip-icon" data-tooltip="Circuito C12 dedicado seg√∫n ITC-BT-52. Wallbox 7kW monof√°sico: cable 10mm¬≤, 32A. Wallbox 11kW trif√°sico: cable 6mm¬≤ (4x). Requiere diferencial 30mA tipo B o A-B. Incrementa potencia m√≠nima a 11.5-15kW.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="domotica"> Sistema dom√≥tico
                            <span class="tooltip-icon" data-tooltip="Circuito adicional de control. Cable bus KNX o similar. Requiere cuadro de distribuci√≥n con espacio para actuadores. Incluye fuente alimentaci√≥n 24V, m√≥dulos de control. Incrementa coste en automatismos y programaci√≥n.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="solar"> Paneles solares
                            <span class="tooltip-icon" data-tooltip="Instalaci√≥n fotovoltaica con vertido o autoconsumo. Requiere l√≠nea DC desde paneles, inversor, protecciones DC (fusibles, descargadores), contador bidireccional. Cuadro independiente. Normativa espec√≠fica: ITC-BT-40, RD 244/2019.">‚ÑπÔ∏è</span>
                        </label>
                        <label>
                            <input type="checkbox" name="special" value="sai"> SAI/UPS
                            <span class="tooltip-icon" data-tooltip="Sistema de alimentaci√≥n ininterrumpida. Circuito dedicado para cargas cr√≠ticas (servidor, dom√≥tica, alarma). Cable 2.5-4mm¬≤ seg√∫n potencia. Requiere toma espec√≠fica y puesta a tierra de calidad. T√≠pico 1-3kVA.">‚ÑπÔ∏è</span>
                        </label>
                    </div>
                </div>

                <!-- Calidad de materiales -->
                <div class="form-section">
                    <h3>üíé Calidad de Materiales</h3>

                    <div class="form-group">
                        <label for="quality">
                            Nivel de acabados:
                            <span class="tooltip-icon" data-tooltip="Determina la gama de materiales y mecanismos. B√°sica: cumple normativa, econ√≥mica. Media: +30-40% sobre b√°sica, marcas reconocidas, mejor est√©tica. Alta: +80-100%, dise√±o premium, dom√≥tica integrable, acabados exclusivos (cristal, acero).">‚ÑπÔ∏è</span>
                        </label>
                        <select id="quality" required>
                            <option value="">Selecciona calidad</option>
                            <option value="basica">B√°sica - Materiales est√°ndar homologados</option>
                            <option value="media">Media - Buena calidad, marcas reconocidas</option>
                            <option value="alta">Alta - Materiales premium, dise√±o</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="brand-preference">
                            Preferencia de marca:
                            <span class="tooltip-icon" data-tooltip="Marca principal para mecanismos y protecciones. Mixta optimiza coste/calidad combinando marcas. Schneider/ABB: referencia industrial, fiabilidad m√°xima. Simon: dise√±o espa√±ol, buen precio. Legrand: gama completa, compatibilidad KNX. Afecta precio final 10-25%.">‚ÑπÔ∏è</span>
                        </label>
                        <select id="brand-preference">
                            <option value="mixta">Mixta (optimizar coste/calidad)</option>
                            <option value="schneider">Schneider Electric</option>
                            <option value="abb">ABB</option>
                            <option value="simon">Simon</option>
                            <option value="legrand">Legrand</option>
                        </select>
                    </div>
                </div>

                <!-- Datos del electricista -->
                <div class="form-section">
                    <h3>üë∑ Datos del Electricista</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="company-name">
                                Empresa:
                                <span class="tooltip-icon" data-tooltip="Nombre comercial o raz√≥n social que aparecer√° en el presupuesto. Debe coincidir con la empresa autorizada en el bolet√≠n el√©ctrico. Aparecer√° en todas las p√°ginas del documento generado.">‚ÑπÔ∏è</span>
                            </label>
                            <input type="text" id="company-name" required placeholder="Tu Empresa El√©ctrica SL">
                        </div>

                        <div class="form-group">
                            <label for="license-number">
                                N¬∫ Autorizaci√≥n REBT:
                                <span class="tooltip-icon" data-tooltip="N√∫mero de registro como instalador autorizado ante el organismo competente de Baleares. Formato BA-XXXXXX. Obligatorio para emitir bolet√≠n el√©ctrico. Se incluir√° en el presupuesto para dar confianza al cliente.">‚ÑπÔ∏è</span>
                            </label>
                            <input type="text" id="license-number" placeholder="BA-001234">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="hourly-rate">
                                Tarifa horaria (‚Ç¨/h):
                                <span class="tooltip-icon" data-tooltip="Coste por hora de trabajo del oficial electricista. Incluye mano de obra directa. En Ibiza: 40-50‚Ç¨/h (est√°ndar), 50-65‚Ç¨/h (especializado). No incluye desplazamientos ni gestiones (se calculan aparte). Afecta directamente al coste final de instalaci√≥n.">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="hourly-rate" min="20" max="100" required placeholder="45">
                        </div>

                        <div class="form-group">
                            <label for="markup">
                                Margen materiales (%):
                                <span class="tooltip-icon" data-tooltip="Porcentaje de beneficio sobre PVP de materiales. Cubre gesti√≥n, transporte, almacenaje, garant√≠as. Habitual en sector: 15-25%. Ibiza suele aplicar 20-30% por sobrecostes log√≠sticos. Se suma al precio de compra antes de presentar al cliente.">‚ÑπÔ∏è</span>
                            </label>
                            <input type="number" id="markup" min="0" max="50" required placeholder="20">
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">‚ö° Calcular Presupuesto</button>
            </form>
        </section>

        <!-- Resultados -->
        <section id="results-section" class="section">
            <div class="results-header">
                <h2>Presupuesto Generado</h2>
                <div class="results-actions">
                    <button onclick="editProject()" class="btn btn-secondary">‚úèÔ∏è Editar</button>
                    <button onclick="downloadBudget()" class="btn btn-primary">üì• Descargar PDF</button>
                </div>
            </div>

            <!-- Validaci√≥n normativa -->
            <div id="normative-validation" class="validation-box"></div>

            <!-- C√°lculos t√©cnicos -->
            <div id="technical-calcs" class="technical-box"></div>

            <!-- Presupuesto detallado -->
            <div id="budget-detail" class="budget-container"></div>
        </section>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p id="loading-text">Calculando instalaci√≥n el√©ctrica...</p>
            <p class="loading-subtext">Validando normativa REBT</p>
        </div>
    </div>

    <script src="js/normativas.js"></script>
    <script src="js/materiales.js"></script>
    <script src="js/calculos.js"></script>
    <script src="js/presupuesto.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
